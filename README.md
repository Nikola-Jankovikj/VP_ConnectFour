# Connect Four
Windows Forms проект од: Никола Јанковиќ, Тодор Јовановски и Теа Минова.
___
## Опис на апликацијата
Апликацијата изработена во овој проект претставува верзија од класичната игра **Connect Four**, проширена со неколку можности кои им даваат повеќе избор и слобода на играчите.

Connect Four е стратешка игра за два играчи, која користи табла (мрежа) со повеќе редови и колони. Играчите наизменично поставуваат по едно крукче во билокоја колона од таблата. Крукчињата го заземаат најнискиот достапен празен простор во избраната колона. Целта е да се биде првиот играч кој ќе поврзе четири свои крукчиња по ред, во билокоја насока (хоризонтално, вертикално, дијагонално). Во случај целосно да се пополни таблата, а притоа ниту еден играч да не поврзе 4 крукчиња, играта завршува нерешено (изедначено).

Aпликацијата во овој проект ги нуди и следните почетни поставки за играта:
- избор за играње со пријател или компјутер
- менување на димензиите на таблата (број на редови и колони)
- можност за ограничување на времето за потег по играч
___
## Упатство за користење
### Main Menu
<!-- слика од Main Menu> -->
<img src="https://github.com/Nikola-Jankovikj/VP_ConnectFour/assets/107946827/6a3c2129-0ebd-4311-ab46-691c230bce71" height="350" />

Со започнување на апликацијата, најпрво се појавува **Main Menu** прозорец, каде играчот ги врши почетните поставки за играта:
- противник: пријател или компјутер
- ниво на тежина за игра против компјутер: easy или hard
- големина на таблата: број на редови (4-8) и број на колони (5-9)
- временско ограничување по потег со избор на интервал (5-120 секунди) (по истекување на времето, редот се префрла на другиот играч)

Во горниот лев агол од прозорецот се наоѓа **Help** копче, кое нуди кратко упатство со правилата на играта.

<!-- слика од How to play? -->
<img src="https://github.com/Nikola-Jankovikj/VP_ConnectFour/assets/107946827/50bd5155-0c10-4717-a8dd-1fc6e90c5c92" height="400" />

Кога играчот е задоволен од внесените параметри може да ја започне играта со притискање на копчето **Start Game**.

### Game
<!-- слики од Game со различни димензии -->
<p float="left">
  <img src="https://github.com/Nikola-Jankovikj/VP_ConnectFour/assets/107946827/ed92864c-bc34-4775-96d8-4dbb8083faf4" height="300" />
  <img src="https://github.com/Nikola-Jankovikj/VP_ConnectFour/assets/107946827/64b77c2d-3257-4e74-9e81-eae065c4c91e" height="300" />
</p>

Со почетокот на играта се појавува нов Game прозорец во кој е исцртана почетно празната табла. Во долниот лев агол се испишува изминатото време од почетокот на играта, додека во долниот десен агол е прикажан играчот од кој се чека следниот потег, опционално придружен со преостанатото време за потегот, во случај да е избрана игра со временско ограничување.

Играчите со клик врз колона, наизменично внесуваат крукчиња (црвени и жолти, за секој играч соодветно), а со придвижување на глувчето врз таблата, со посветла боја е означена позицијата на која би се поставило крукчето во соодветната колона. 

По завршување на играта се појавува **Message Box** каде е наведен победникот (или дека играта завршила нерешено) и е даден избор за започнување на нова игра или излез од играта со враќање на **Main Menu** прозорецот.

<!-- слики од двата вида MessageBox -->
<p float="left">
  <img src="https://github.com/Nikola-Jankovikj/VP_ConnectFour/assets/107946827/2c5317c0-9208-4177-b738-29fca6cadf3e" height="125" />
  <img src="https://github.com/Nikola-Jankovikj/VP_ConnectFour/assets/107946827/e99a7730-6099-4ecd-9694-41da96100d25" height="125" />
</p>

___
## Решение на проблемот
### Податочни структури
За правилно функционирање на апликацијата се користат следните класи:
- MainMenuForm
- GameForm
- Scene
- Circle
- MinMaxAlgorithm (преземено и модифицирано)
- Board (преземено и модифицирано)
- TranspositionTable (целосно преземено)
- MoveCache (целосно преземено)

Во продолжение е дадена структурата на класите кои се самостојно изработени од членовите на тимот за овој проект.

### MainMenuForm
Оваа класа ги содржи потребните податоци и методи за Main Menu прозорецот и тоа:

***bool WithBot*** - дали се игра против компјутер  
***static int Rows*** - број на редови  
***static int Cols*** - број на колони  
***int TurnTimeLimit*** - времетраење на ограничувањето по потег  
***bool BotIsEasy*** - тежина на игра против компјутер  

***MainMenuForm()*** - конструктор  
***void cbHasTurnTimeLimit_CheckedChanged(object sender, EventArgs e)*** - поставување на временско ограничување по потег  
***void startBtn_Click(object sender, EventArgs e)*** - започнување на играта  
***void GetValues()*** - добивање на сите поставки од формата  
***void rbPlayAgainstComputer_CheckedChanged(object sender, EventArgs e)*** - избор за игра против компјутер  
***void btnHelp_Click(object sender, EventArgs e)*** - приказ на упатство за играта  

### GameForm
Оваа класа ги содржи потребните податоци и методи за Game прозорецот и тоа:

***Scene scene*** - објект од класата Scene (за таблата)  
***int turnTimeLimit*** - времетраење на ограничувањето по потег  
***int totalTimeTicks*** - секунди поминати од почетокот на играта  
***int turnTimeTicks*** - преостанати секунди за моменталниот потег  
***int rows*** - број на редови  
***int columns*** - број на колони  
***bool withBot*** - дали се игра против компјутер  
***bool hasTurnTimeLimit*** - дали има временско ограничување по потег  
***bool botIsEasy*** - тежина на игра против компјутер  
***MainMenuForm parent*** - референца до објектот од тип MainMenuForm каде е креиран објектот од класата GameForm  

***GameForm(bool withBot, int turnTimeLimit, int rows, int cols, MainMenuForm parent, bool botIsEasy)*** - конструктор со аргументи  
***void GameForm_Paint(object sender, PaintEventArgs e)*** - исцртување на scene (таблата)  
***void GameForm_MouseClick(object sender, MouseEventArgs e)*** - поставување на крукче  
***bool CheckWinner()*** - проверка за победа  
***void ResetTurnTimer()*** - враќање на тајмерот за ограничено време на почетната вредност  
***void ShowGameFinishedWithDrawDialog()*** - приказ на прозорец за нерешен крај на игра  
***void ShowPlayerWonDialog()*** - приказ на прозорец за крај на игра со победник  
***string calculatePlayer()*** - моментален играч  
***void changeStyle()*** - поставување на боја соодветна на моментален играч (црвена или жолта)  
***void timer1_Tick(object sender, EventArgs e)*** - отчукување на тајмерот за вкупно време од почеток на играта  
***void timer2_Tick(object sender, EventArgs e)*** - отчукување на тајмерот за ограничено време по потег  
***string formatTimeToText(int time)*** - форматирање на вкупно време од почеток на игра  
***void formatTurnTimeText()*** - форматирање на преостанато време за потег   
***void GameForm_FormClosing(object sender, FormClosingEventArgs e)*** - затворање на Game прозорецот  
***void GameForm_MouseMove(object sender, MouseEventArgs e)*** - обележување на позицијата на која би се поставило крукче во соодветната колона  

### Scene
Оваа класа ги содржи потребните податоци и методи за функционирање на таблата прикажана во Game прозорецот и тоа:

***static int DistanceBetweenCircles*** - растојание помеѓу крукчињата во таблата  
***int Rows*** - број на редови  
***int Cols*** - број на колони  
***bool WithBot*** - дали се игра против компјутер  
***Circle[,] Circles*** - матрица (дводимензионална низа) од објекти од тип Circle  
***bool IsPlayerOne*** - моментален играч  
***int LastCircleRow*** - ред во кој се наоѓа последно додаденото крукче  
***int LastCircleCol*** - колона во која се наоѓа последно додаденото крукче  
***int moves*** - број на направени потези  
***MiniMaxAlgorithm Computer*** - објект од класата MinMaxAlgorithm (за игра спротив компјутер)  

***Scene(int rows, int cols, bool withBot, bool botIsEasy)*** - конструктор со аргументи  
***int[,] generateIntMatrix()*** - генерирање матрица со елементи 0(празно), 1(крукче од прв играч) и 2(крукче од втор играч) соодветна на Circles (потребна за MinMaxAlgorithm)  
***bool AddCircle(Point location)*** - додавање на ново крукче во таблата (пресметка на колоната)  
***bool MakeMove(int col)*** - додавање на ново крукче во таблата (пресметка на редот)  
***void Draw(Graphics g)*** - исцртување на табелата  
***bool DidPlayerWin()*** - проверка за победа  
***bool IsTableFull()*** - проверка за целосно пополнета табела  
***void turnTimeEnded()*** - менување на моменталниот играч по истекување на времето за потег  
***void MarkInHovered(Point location)*** - обележување на позицијата на која би се поставило крукче во соодветната колона  
***void removePreviousHover()*** - отстранување на претходно обележаното крукче  

### Circle
Оваа класа ги содржи потребните податоци и методи за крукчињата од кои е составена таблата и тоа:

***Point Center*** - центар на крукчето  
***static int Radius*** - радиус на крукчето  
***Color Color*** - боја на крукчето (црвена - Player 1, жолта - Player 2, бела - празно, светло црвена - hover на Player 1, светло жолта - hover на Player 2)  

***Circle(Point center)*** - конструктор со аргумент  
***void Draw(Graphics g)*** - исцртување на крукчето  

### Останато
Останатите класи, MinMaxAlgorithm, Board, TranspositionTable и MoveCache,се преземени од https://github.com/jackkimmins/Connect-Four-AI и врз нив се направени модификации за совпаѓање со претходно наведените класи (првично направени да работат само за една специфична големина на табла, преработени да работат со произволна големина). 

Класата **MinMaxAlgorithm** го содржи главниот алгоритам за наоѓање на оптимален следен потег (со различни нивоа на интелигенција). Оваа класа се користи кога играчот игра против компјутерот, за со помош на вештачка интелигенција да се одредат потезите на компјутерот. Во рамки на класата Scene се повикува методот ***GetBestMove*** преку објектот Computer од тип MinMaxAlgorithm, која како резултат враќа променлива од структурата ***ReturnMove***, која во себе го содржи редниот број на колоната каде треба да се постави крукчето. Притоа објектот Computer во зависност од селектираното ниво на тежина на играта (easy или hard), е поставен да ги врши пресметките со помала или поголема длабочина (ниво на интелигенција).

Класата MinMaxAlgorithm е изработена да работи со објекти од класата **Board**, која содржи слични податоци како класата Scene, со тоа што матрицата за крукчињата не содржи објекти од типот Circle, туку броеви 0, 1 или 2, во зависност од тоа дали полето е празно или заземено од крукче на првиот или вториот играч соодветно. Од таа причина, во рамки на класата Scene, со помош на методот ***generateIntMatrix()***, се креира објект од тип Board со новогенерирана матрица од броеви според веќепостоечката Circles, кој потоа се предава на GetBestMove функцијата на објектот Computer.

Класите **TranspositionTable** и **MoveCache** се користат за зачувување на привремените пресметки (резултати од можни потези) на MinMaxAlgorithm.
___
## Детален опис на функциите за додавање на крукче во класата Scene
### bool AddCircle(Point location)
```
public bool AddCircle(Point location)
{
    removePreviousHover();

    int col = -1;

    if (WithBot && !IsPlayerOne)
    {
        Board currentBoard = new Board(generateIntMatrix(), 2, moves, Rows, Cols);
        col = Computer.GetBestMove(currentBoard).Column - 1;
    }
    else
    {
        col = location.X / (2 * Circle.Radius + 2 * DistanceBetweenCircles);

        if (Circles[0, col].Color != Color.White)
        {
            return false;
        }
    }

    return MakeMove(col);
}
```

Оваа функција од класата **GameForm** како аргумент ја добива точката (**location**) во која што е направен клик врз таблата. Во неа најпрво се повикува методот **removePreviousHover()** со која се отстранува претходно обележаното крукче (на hover), така што таблата се состои само од црвени, жолти и празни(бели) крукчиња. Потоа се иницијализира int променливата **col**, која ќе го содржи бројот на колоната врз која е направен кликот. Бидејќи оваа функција се повикува и за потег на компјутерот (кој не прави кликови), во оваа функција се прави проверка дали се игра против компјутер и дали истиот е на ред за потег, а во случај да се исполнети тие два услови, се пристапува до **MinMaxAlgorithm** на начинот којшто е објаснет погоре. Во спротивно колоната врз која е направен клик се добива како резултат од целобројното делење на X координатата на location со ширината на колоната. Потоа се прави проверка дали воопшто има празно место во пресметаната колона (дали крукчето на врвот е бело). Во случај колоната да е целосно пополнета, функцијата прекинува. По конечната пресметка на бројот на колоната за додавање на крукче (преку компјутер или со клик), функцијата завршува со повикување на функцијата **MakeMove()**, чиј резултат (bool) се враќа на класата **GameForm**.

### bool MakeMove(int col)
```
private bool MakeMove(int col)
{
    int row = 0;

    while (row + 1 < Rows && Circles[row + 1, col].Color == Color.White)
    {
        row++;
    }

    Circles[row, col].Color = IsPlayerOne ? Color.Crimson : Color.Gold;
    LastCircleRow = row;
    LastCircleCol = col;
    IsPlayerOne = !IsPlayerOne;
    moves++;

    return true;
}
```

Оваа функција има за цел да го пресмета редот во кој треба да се додаде крукчето и да го изврши додавањето. Најпрво се иницијализира int променливата **row** со почетна вредност 0, која ќе го содржи бројот на редот. Со помош на while циклус, во секоја итерација вредноста на row се зголемува за 1, сѐ додека крукчето во претходно одредената колона и редот row+1 е бело (празно). По излезот од циклусот, променливата **row** го содржи бројот на редот во кој треба да се додаде крукчето. Според моменталниот играч, бојата на крукчето со точната позиција се менува во црвена или жолта. Променливите **LastCircleRow** и **LastCircleCol** се ажурираат со новопресметаните ред и колона. Променливата **IsPlayerOne** се менува за да го претставува другиот играч како моментален. Се зголемува бројот на потези и функцијата враќа true.
